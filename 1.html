<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>
        // 지갑 주소 확인
        Walletconnect = function(){
            if(window.klaytn !== 'undefined'){
                if(window.klaytn.isKaikas){
                    const accounts = window.klaytn.enable();
                    const account = accounts[0];
                    let OwnerAddress = klaytn.selectedAddress;
                    alert("address : " + OwnerAddress); // 유저 지갑 주소
                    UserAction(OwnerAddress);                    
                }
            }
        }

        //지갑내 메타데이터 확인
        function UserAction(GetAddress) {
            alert(GetAddress);
            const Nftaddress = "0x05ffcbfd7fe222da0b2f39fd038407cd4dd8fcc1"; // NFT 
//            Getaddress = "0xe7cfc757fd8858052664ebd38f645e2f7468ff37";


            var xhttp = new XMLHttpRequest();            
            xhttp.onreadystatechange = function() {
                 if (this.readyState == 4 && this.status == 200) {
                     alert(this.response);
                    let json = JSON.parse(this.response); // 응답된 JSON 텍스트를 객체로 변환
                    let i = json.items.length; // items 개수 확인


                    // 지갑내 메타데이터내 이미지 확인
                    var xhttpjs = new XMLHttpRequest();
                    xhttpjs.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            let jsonimg = JSON.parse(this.response); // 응답된 JSON 텍스트를 객체로 변환
                            alert(jsonimg.image);
                        // 이미지 띄우기

                        var x = document.createElement("IMG");
                        x.setAttribute("src", jsonimg.image);
                        x.setAttribute("width", "304");
                        x.setAttribute("height", "228");
                        x.setAttribute("alt", "no image");
                        document.body.appendChild(x);
                        }
                    };
                    //지갑내 메타데이터내 이미지 주소 불러오기
                    xhttpjs.open("GET", json.items[0].tokenUri, false);
                    xhttpjs.send();
                }

            }
            xhttp.open("GET", "https://th-api.klaytnapi.com/v2/contract/nft/" + Nftaddress + "/owner/" + Getaddress, true);
            xhttp.setRequestHeader("Authorization", "Basic S0FTS09JOTVJOTlHSkVGUDJFQUZFOEY2OmNOeGZvTHlMYVRUVHBobUltM0NWRFVxa21JMjViZm9pcWIySzJTNDg=");
            xhttp.setRequestHeader("Content-type", "application/json");
            xhttp.setRequestHeader("x-chain-id", "8217");
            
            xhttp.send();
            alert(xhttp.status);
        }
    </script>
</head>
<body>
    <button type="submit" onclick="Walletconnect()">connect wallet</button>
</body>
</html>
